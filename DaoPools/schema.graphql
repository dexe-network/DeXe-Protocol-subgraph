type DPContract @entity(immutable: true) {
  id: Bytes! # DP contract address
  daoPool: Bytes!
}

type SettingsContract @entity(immutable: true) {
  id: Bytes! # settings contract address
  daoPool: Bytes!
}

type DaoPool @entity {
  id: Bytes! # pool address
  name: String!

  votersCount: BigInt!
  creationTime: BigInt!
  creationBlock: BigInt!

  proposalCount: BigInt!

  voters: [VoterInPool!]! @derivedFrom(field: "pool")
  proposals: [Proposal!]! @derivedFrom(field: "pool")
  settings: [ProposalSettings!]! @derivedFrom(field: "pool")
  executors: [Executor!]! @derivedFrom(field: "pool")
}

type Voter @entity {
  id: Bytes! # voter address
  pools: [VoterInPool!]! @derivedFrom(field: "voter")
}

type Proposal @entity {
  id: Bytes! # pool address + porposalId
  proposalId: BigInt!

  creator: Bytes!

  executor: Bytes!
  executionTimestamp: BigInt!

  currentVotes: BigInt!
  quorum: BigInt!
  description: String!

  votersVoted: BigInt!
  pool: DaoPool!

  distributionProposal: DistributionProposal!

  settings: ProposalSettings!

  voters: [Voter!]!

  votes: [ProposalVote!]! @derivedFrom(field: "proposal")
}

type VoterInPool @entity {
  id: Bytes! # voter address + pool address
  receivedDelegation: BigInt!
  receivedNFTDelegation: [BigInt!]!
  totalDPClaimed: BigInt!
  totalClaimedUSD: BigInt!

  currentDelegatorsCount: BigInt!

  pool: DaoPool!
  voter: Voter!

  proposals: [VoterInProposal!]! @derivedFrom(field: "voter")
  claimedDPs: [DistributionProposal!]!
}

type ProposalVote @entity(immutable: true) {
  id: Bytes! # tx hash + counter
  hash: Bytes!
  timestamp: BigInt!

  personalAmount: BigInt!
  delegatedAmount: BigInt!

  voter: VoterInProposal!
  proposal: Proposal!
}

type VoterInProposal @entity {
  id: Bytes! # voter in pool address + proposal entity id
  pool: DaoPool!
  proposal: Proposal!
  voter: VoterInPool!

  totalVoteAmount: BigInt!
  totalDelegatedVoteAmount: BigInt!

  claimedReward: BigInt!

  votes: [ProposalVote!]! @derivedFrom(field: "voter")
}

type DistributionProposal @entity {
  id: Bytes! # proposal entity id
  token: Bytes!
  amount: BigInt!
}

type DelegationHistory @entity(immutable: true) {
  id: Bytes! # tx hash + counter
  pool: DaoPool!
  timestamp: BigInt!

  from: Voter!
  to: Voter!
  isDelegate: Boolean!

  amount: BigInt!
  nfts: [BigInt!]!

  pair: VoterInPoolPair!
}

type ProposalSettings @entity {
  id: Bytes! # pool address + settingsId
  settingsId: BigInt!

  executorDescription: String!

  executors: [Executor!]! @derivedFrom(field: "settings")
  pool: DaoPool!
}

type Executor @entity {
  id: Bytes! # dao pool address + executor address
  executorAddress: Bytes!

  settings: ProposalSettings!

  pool: DaoPool!
}

type VoterInPoolPair @entity {
  id: Bytes!

  from: VoterInPool!
  to: VoterInPool!

  delegateAmount: BigInt!
  delegateNfts: [BigInt!]!

  history: [DelegationHistory!]! @derivedFrom(field: "pair")
}

# @notice The entity counts interactions in single tx
# @param id forms from tx hash
# @param count the counter of interactions in single tx
type InteractionCount @entity {
  id: Bytes!
  count: BigInt!
}
